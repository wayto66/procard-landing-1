# -*- coding: utf-8 -*-
from __future__ import unicode_literals

from django import forms
from django.core.mail import EmailMessage
from django.template.loader import render_to_string
from django.utils import timezone

from .models import Newsletter

class NewsletterForm(forms.ModelForm):
    class Meta:
        model = Newsletter
        fields = (
            'nome',
            'email_newsletter',
            'telefone',
        )

    def send_email(self):

        template = 'emails/newsletter.txt'
        name = self.cleaned_data.get('email_newsletter')
        from_email = self.cleaned_data.get('email_newsletter')
        subject_message = self.cleaned_data.get('email_newsletter')

        to_email = [
            'will@atualinterativa.com.br',
        ]
        subject = '[MORE BR - Newsletter] {}'.format(subject_message)
        message = render_to_string(
            template, {
                'form': self.cleaned_data,
                'data': now(),
            }
        )

        email = EmailMessage(

            subject=subject,
            body=message,
            from_email=from_email,
            to=to_email,
            reply_to=(from_email,)
        )
        return email.send()
